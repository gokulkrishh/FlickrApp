<!doctype html>
<html ng-app="FlickrApp">
  <head>
    <meta http-equiv="content-script-type" content="text/javascript">
    <title>Flickr Application</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
  </head>
<body>
  <!-- navbar -->
  <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <a href="/" class="navbar-brand">Flick App</a>
      </div>
      <ul class="nav navbar-nav navbar-left">
        <li><a href="#/">Home</a></li>
        <li><a href="#/photos">About App</a></li>
      </ul> 
    </div>
  </nav>
  <!-- view  -->
  <div class="controller" style="min-height:500px;margin-top:5%;">
      <div ng-view></div>
  </div>
  <!-- footer  -->
  <div id="footer">
    <div class="container">
      <p>Site Designed and Developed by gokulkrishh</p>
    </div>
  </div>
  <script type="text/javascript" src="scripts/angular.min.js"></script>
  <script type="text/javascript" src="scripts/angular-route.js"></script>
  <script type="text/javascript" src="scripts/jquery-2.0.2.min.js"></script>
  <script type="text/javascript" src="scripts/bootstrap.min.js"></script>
  <script>
      //created a module called FlickrApp
      var FlickrApp = angular.module('FlickrApp',['ngRoute']); 
      
      // adding controller as myController 
      FlickrApp.controller('myController',publicFeed); 

      // creating a factory service
      FlickrApp.factory('fetchPhotos',function($http,$q){
        var url = "http://api.flickr.com/services/feeds/photos_public.gne?format=json&callback=jsonFlickrFeed";
        //var url = "/simple.json";
        var defered = $q.defer();
        var params = {
          jsoncallback: 'JSON_CALLBACK'
        };
        return{
            fetchData :function(){
            $http.jsonp(url,{
              params:params
            }).success(function(data) {
              defered.resolve(data);
            }).error(function(data) {
              defered.resolve("Error Occurred");
            });
            return defered.promise;
          }
        }
      });
        
        //passing a fectchPhotos factory service
        function publicFeed($scope,fetchPhotos) {
        $scope.details = [];
        fetchPhotos.fetchData().then(function(data){
          $scope.details = data;
        },
        function(err){
          $scope.details = err;
          console.log(err);
        });
      } 
      // user photo controller
      FlickrApp.controller('photoController',userPhotoId);
      function userPhotoId($scope,$rootScope,$http,$q) {
        $scope.message = "hi";
        $scope.userData;
        $rootScope.userPhotos = [];
        $scope.myPublicPic = function(photoid,authorname) {
        $scope.userid = photoid;
        if(photoid !== "" || null)
        {
          var api_key = 'c2571fbbfd51eadf7913b812d9c4f502';
          var url1 = "http://api.flickr.com/services/rest/?method=flickr.photos.search&sort=date-taken-desc&api_key="
          +api_key+"&user_id="+photoid+"&per_page=12&format=json&callback=jsonFlickrApi";
          var defered1 = $q.defer();
          //console.log(url1);
          $scope.params = {
            jsoncallback: 'JSON_CALLBACK',
          }
          $scope.getUserId = function(){
          $http.jsonp(url1,{
            params:$scope.params
          }).success(function(data) {
            console.log("1st call");
            defered1.resolve(data);
          }).error(function(data) {
            alert("1st error");
            defered1.resolve("Error Occurred");
          });
          return defered1.promise;
          }
          $scope.getUserId().then(function(data)
          {            
            $scope.userData = data;
            //console.log($scope.userData);
             for(var i in $scope.userData.photos.photo){
              var url = "http://farm"+ $scope.userData.photos.photo[i].farm +".staticflickr.com/"+$scope.userData.photos.photo[i].server+"/"+ $scope.userData.photos.photo[i].id+"_"+$scope.userData.photos.photo[i].secret+".jpg";
              $rootScope.userPhotos.push(url);
              //console.log($rootScope);
            }
            //console.log($rootScope);
          },
          function(err){
            $rootScope.userPhotos = err;
            console.log(err);
           });
        }    
      }
  }
    //service for friend list
    FlickrApp.controller('FriendPic',friendList);
    function friendList(fetchPhotos) {
        $scope.details = [];
        fetchPhotos.fetchData().then(function(data){
          $scope.details = data;
        },
        function(err){
          $scope.details = err;
          console.log(err);
        });
        console.log(data);
    }
    //routing 
      FlickrApp.config(function($routeProvider) {
      $routeProvider.
        when('/', 
        {
          controller:'myController', 
          templateUrl:'templates/Publicphotos.html',
        });
        $routeProvider.when('/photos', 
        {
          controller:'photoController', 
          templateUrl:'templates/Userphotos.html',
        });
        $routeProvider.when('/friendlist', 
        {
          controller:'photoController', 
          templateUrl:'templates/Userphotos.html',
        });
        $routeProvider.otherwise({redirectTo:'/'});
      });
</script>
</body>
</html>

